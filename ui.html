<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>í…ìŠ¤íŠ¸ ë²ˆì—­ê¸°1222</title>
    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        font-family: Inter, -apple-system, BlinkMacSystemFont, "Segoe UI",
          Roboto, sans-serif;
        font-size: 12px;
        line-height: 1.5;
        background: #f8f9fa;
        padding: 16px;
        height: 100vh;
        overflow: hidden;
      }

      .container {
        max-width: 100%;
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        overflow: hidden;
        height: calc(100vh - 32px);
        display: flex;
        flex-direction: column;
      }

      .header {
        background: #4f46e5;
        color: white;
        padding: 16px;
        text-align: center;
      }

      .header h1 {
        font-size: 16px;
        font-weight: 600;
        margin-bottom: 4px;
      }

      .header p {
        font-size: 11px;
        opacity: 0.8;
      }

      /* API í‚¤ëŠ” .env íŒŒì¼ì—ì„œ ìë™ ê´€ë¦¬ë˜ë¯€ë¡œ ê´€ë ¨ ìŠ¤íƒ€ì¼ ë¶ˆí•„ìš” */

      .content {
        padding: 16px;
        flex: 1;
        overflow: hidden;
        display: flex;
        flex-direction: column;
      }

      .main-content {
        display: flex;
        flex-direction: column;
        flex: 1;
        overflow: hidden;
      }

      .text-pair-container {
        flex: 1;
        overflow-y: auto;
        padding: 8px;
        min-height: 0;
      }

      .text-pair {
        display: flex;
        gap: 12px;
        margin-bottom: 12px;
        align-items: stretch;
      }

      .text-pair .text-item,
      .text-pair .ux-item {
        flex: 1;
        margin-bottom: 0;
      }

      .panel-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 8px;
        padding-bottom: 8px;
        border-bottom: 2px solid #e5e7eb;
      }

      .panel-title {
        font-size: 13px;
        font-weight: 600;
        color: #374151;
      }

      .panel-subtitle {
        font-size: 10px;
        color: #6b7280;
      }

      .section {
        flex: 1;
        display: flex;
        flex-direction: column;
        overflow: hidden;
      }

      .section h2 {
        font-size: 13px;
        font-weight: 600;
        color: #374151;
        margin-bottom: 8px;
      }

      .text-list {
        background: #f9fafb;
        border: 1px solid #e5e7eb;
        border-radius: 6px;
        flex: 1;
        overflow-y: auto;
        padding: 8px;
      }

      .text-item {
        padding: 12px 16px;
        margin-bottom: 8px;
        background: white;
        border-radius: 6px;
        font-size: 12px;
        color: #374151;
        border-left: 3px solid #e5e7eb;
        word-break: break-all;
        cursor: pointer;
        transition: all 0.2s;
        position: relative;
        line-height: 1.4;
      }

      .text-item:hover {
        border-left-color: #4f46e5;
        background: #f8fafc;
        transform: translateY(-1px);
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .text-item:last-child {
        margin-bottom: 0;
      }

      .text-item.active {
        border-left-color: #4f46e5;
        background: #eef2ff;
        box-shadow: 0 2px 8px rgba(79, 70, 229, 0.15);
      }

      .text-item.changed {
        border-left-color: #10b981;
        background: #f0fdf4;
      }

      .text-item-badge {
        position: absolute;
        top: 6px;
        right: 6px;
        background: #4f46e5;
        color: white;
        font-size: 9px;
        padding: 3px 6px;
        border-radius: 3px;
        opacity: 0;
        transition: opacity 0.2s;
      }

      .text-item.changed .text-item-badge {
        opacity: 1;
        background: #10b981;
      }

      .text-item.active .text-item-badge {
        opacity: 1;
      }

      .text-item.highlighted,
      .ux-item.highlighted {
        border-left-color: #ef4444 !important;
        background: #fef2f2 !important;
        box-shadow: 0 0 0 2px #ef4444, 0 4px 12px rgba(239, 68, 68, 0.3) !important;
        transform: scale(1.02);
        animation: highlight-pulse 0.6s ease-in-out;
      }

      .text-item.nearest-highlighted,
      .ux-item.nearest-highlighted {
        border-left-color: #f59e0b !important;
        background: #fffbeb !important;
        box-shadow: 0 0 0 2px #f59e0b, 0 4px 12px rgba(245, 158, 11, 0.3) !important;
        transform: scale(1.01);
      }

      @keyframes highlight-pulse {
        0% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.05);
        }
        100% {
          transform: scale(1.02);
        }
      }

      .ux-writing-list {
        background: #fefefe;
        border: 1px solid #e5e7eb;
        border-radius: 6px;
        flex: 1;
        overflow-y: auto;
        padding: 8px;
      }

      .ux-item {
        padding: 12px 16px;
        margin-bottom: 8px;
        background: #f8f9fa;
        border-radius: 6px;
        font-size: 12px;
        color: #374151;
        border-left: 3px solid #fbbf24;
        word-break: break-all;
        cursor: pointer;
        transition: all 0.2s;
        position: relative;
        line-height: 1.4;
      }

      .ux-item:hover {
        border-left-color: #f59e0b;
        background: #fffbeb;
        transform: translateY(-1px);
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .ux-item:last-child {
        margin-bottom: 0;
      }

      .ux-item.active {
        border-left-color: #f59e0b;
        background: #fffbeb;
        box-shadow: 0 2px 8px rgba(245, 158, 11, 0.15);
      }

      .language-selector {
        margin-bottom: 16px;
      }

      .language-selector label {
        display: block;
        font-size: 11px;
        color: #374151;
        margin-bottom: 4px;
        font-weight: 500;
      }

      .language-selector select {
        width: 100%;
        padding: 8px 12px;
        border: 1px solid #d1d5db;
        border-radius: 6px;
        font-size: 12px;
        background: white;
        color: #374151;
      }

      .language-selector select:focus {
        outline: none;
        border-color: #4f46e5;
        box-shadow: 0 0 0 2px rgba(79, 70, 229, 0.1);
      }

      .button-group {
        display: flex;
        gap: 8px;
      }

      .btn {
        flex: 1;
        padding: 10px 16px;
        border: none;
        border-radius: 6px;
        font-size: 12px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s;
      }

      .btn-primary {
        background: #4f46e5;
        color: white;
      }

      .btn-primary:hover:not(:disabled) {
        background: #4338ca;
      }

      .btn-secondary {
        background: #f3f4f6;
        color: #374151;
        border: 1px solid #d1d5db;
      }

      .btn-secondary:hover:not(:disabled) {
        background: #e5e7eb;
      }

      .btn-ux {
        background: #f59e0b;
        color: white;
      }

      .btn-ux:hover:not(:disabled) {
        background: #d97706;
      }

      .btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      .loading {
        display: none;
        text-align: center;
        padding: 16px;
        color: #6b7280;
        font-size: 11px;
      }

      .loading.show {
        display: block;
      }

      .spinner {
        display: inline-block;
        width: 16px;
        height: 16px;
        border: 2px solid #f3f4f6;
        border-radius: 50%;
        border-top-color: #4f46e5;
        animation: spin 1s ease-in-out infinite;
        margin-right: 8px;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      .status {
        margin-top: 16px;
        padding: 8px 12px;
        border-radius: 6px;
        font-size: 11px;
        display: none;
      }

      .status.success {
        background: #f0f9f0;
        color: #065f46;
        border: 1px solid #a7f3d0;
        display: block;
      }

      .empty-state {
        text-align: center;
        padding: 32px 16px;
        color: #9ca3af;
        font-size: 11px;
      }

      .empty-state .icon {
        font-size: 24px;
        margin-bottom: 8px;
      }

      .text-list::-webkit-scrollbar,
      .ux-writing-list::-webkit-scrollbar,
      .text-pair-container::-webkit-scrollbar {
        width: 6px;
      }

      .text-list::-webkit-scrollbar-track,
      .ux-writing-list::-webkit-scrollbar-track,
      .text-pair-container::-webkit-scrollbar-track {
        background: #f1f5f9;
        border-radius: 3px;
      }

      .text-list::-webkit-scrollbar-thumb,
      .ux-writing-list::-webkit-scrollbar-thumb,
      .text-pair-container::-webkit-scrollbar-thumb {
        background: #cbd5e1;
        border-radius: 3px;
      }

      .text-list::-webkit-scrollbar-thumb:hover,
      .ux-writing-list::-webkit-scrollbar-thumb:hover,
      .text-pair-container::-webkit-scrollbar-thumb:hover {
        background: #94a3b8;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>í…ìŠ¤íŠ¸ ë²ˆì—­ê¸°</h1>
        <p>Figma í˜ì´ì§€ì˜ í…ìŠ¤íŠ¸ë¥¼ ë‹¤ë¥¸ ì–¸ì–´ë¡œ ë²ˆì—­í•©ë‹ˆë‹¤</p>

        <!-- API í‚¤ëŠ” .env íŒŒì¼ì—ì„œ ìë™ìœ¼ë¡œ ë¡œë“œë©ë‹ˆë‹¤ -->
      </div>

      <div class="content">
        <div class="main-content">
          <div class="section">
            <div
              style="
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 16px;
                flex-shrink: 0;
              "
            >
              <div style="display: flex; gap: 20px">
                <h2 style="color: #4f46e5">ì›ë³¸ í…ìŠ¤íŠ¸</h2>
                <h2 style="color: #f59e0b">UX Writing</h2>
              </div>
              <div style="font-size: 11px; color: #6b7280">
                í´ë¦­í•˜ì—¬ í…ìŠ¤íŠ¸ ì ìš©
              </div>
            </div>
            <div id="textPairContainer" class="text-pair-container">
              <div class="empty-state">
                <div class="icon">ğŸ”</div>
                <div>í…ìŠ¤íŠ¸ë¥¼ ê²€ìƒ‰í•˜ëŠ” ì¤‘...</div>
              </div>
            </div>
          </div>

          <div class="section" style="flex: 0 0 auto; margin-top: 16px">
            <div class="language-selector">
              <label for="languageSelect">ë²ˆì—­í•  ì–¸ì–´ ì„ íƒ</label>
              <select id="languageSelect">
                <option value="">ì–¸ì–´ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
              </select>
            </div>

            <div class="button-group">
              <button id="refreshBtn" class="btn btn-secondary">
                ğŸ”„ í…ìŠ¤íŠ¸ ìƒˆë¡œê³ ì¹¨
              </button>
              <button id="regenerateUxBtn" class="btn btn-ux">
                âœ¨ UX ë¼ì´íŒ… ì¬ìƒì„±
              </button>
              <button id="translateBtn" class="btn btn-primary" disabled>
                ğŸŒ ë²ˆì—­í•˜ê¸°
              </button>
            </div>

            <div id="loading" class="loading">
              <div class="spinner"></div>
              ë²ˆì—­ ì¤‘ì…ë‹ˆë‹¤...
            </div>

            <div id="status" class="status"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- UI ë¡œì§ì€ ui.jsì—ì„œ ì²˜ë¦¬ë©ë‹ˆë‹¤ -->
    <script>
      console.log("ğŸ§ª HTMLì—ì„œ ui.js ë¡œë“œ ì‹œë„ ì „");
    </script>
    <script>
      // ui.js ë‚´ìš©ì„ ì¸ë¼ì¸ìœ¼ë¡œ í¬í•¨
      "use strict";
      console.log("ğŸš€ UI ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œë¨ (ì¸ë¼ì¸)");
      console.log("ğŸ“… í˜„ì¬ ì‹œê°„:", new Date().toISOString());
      console.log("ğŸŒ User Agent:", navigator.userAgent);

      // DOMì´ ì™„ì „íˆ ë¡œë“œë˜ì—ˆëŠ”ì§€ í™•ì¸
      document.addEventListener("DOMContentLoaded", function () {
        console.log("ğŸ“‹ DOMContentLoaded ì´ë²¤íŠ¸ ë°œìƒ");
      });

      // ì¦‰ì‹œ ì‹¤í–‰í•˜ì—¬ ì—°ê²° í™•ì¸
      setTimeout(() => {
        console.log("âš¡ ui.js ìŠ¤í¬ë¦½íŠ¸ê°€ ì •ìƒì ìœ¼ë¡œ ì‹¤í–‰ë˜ê³  ìˆìŠµë‹ˆë‹¤!");

        // DOM ìš”ì†Œë“¤ì´ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸
        const testElements = [
          "textList",
          "uxWritingList",
          "languageSelect",
          "refreshBtn",
          "translateBtn",
        ];

        testElements.forEach((id) => {
          const element = document.getElementById(id);
          console.log(`ğŸ” ${id}:`, element ? "âœ… ì¡´ì¬" : "âŒ ì—†ìŒ");
        });

        // ì‹¤ì œ ì´ˆê¸°í™” ì‹œì‘
        initializeUI();
      }, 100);

      // UI ì´ˆê¸°í™” í•¨ìˆ˜
      function initializeUI() {
        console.log("ğŸ¯ UI ì´ˆê¸°í™” ì‹œì‘");

        // UI ìš”ì†Œë“¤ ì°¾ê¸°
        const textListElement = document.getElementById("textList");
        const uxWritingListElement = document.getElementById("uxWritingList");
        const languageSelectElement = document.getElementById("languageSelect");
        const refreshBtnElement = document.getElementById("refreshBtn");
        const translateBtnElement = document.getElementById("translateBtn");
        const loadingElement = document.getElementById("loading");
        const statusElement = document.getElementById("status");

        // API í‚¤ëŠ” .env íŒŒì¼ì—ì„œ ìë™ ë¡œë“œ

        console.log("ğŸ” DOM ìš”ì†Œ ì°¾ê¸° ê²°ê³¼:");
        console.log("  textListElement:", !!textListElement);
        console.log("  uxWritingListElement:", !!uxWritingListElement);
        console.log("  languageSelectElement:", !!languageSelectElement);

        // ìƒíƒœ ê´€ë¦¬
        let currentTexts = [];
        let currentUxTexts = [];
        let supportedLanguages = {};

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡

        // API í‚¤ëŠ” .env íŒŒì¼ì—ì„œ ìë™ ë¡œë“œë˜ë¯€ë¡œ ë³„ë„ ì„¤ì • ë¶ˆí•„ìš”

        if (languageSelectElement) {
          languageSelectElement.addEventListener("change", (e) => {
            const selectedLanguage = e.target.value;
            console.log("ğŸŒ ì–¸ì–´ ì„ íƒë¨:", selectedLanguage);

            // ë²ˆì—­ ë²„íŠ¼ í™œì„±í™”/ë¹„í™œì„±í™”
            if (translateBtnElement) {
              translateBtnElement.disabled = !selectedLanguage;
              console.log(
                "ğŸ”˜ ë²ˆì—­ ë²„íŠ¼ ìƒíƒœ:",
                selectedLanguage ? "í™œì„±í™”" : "ë¹„í™œì„±í™”"
              );
            }
          });
        }

        if (translateBtnElement) {
          translateBtnElement.addEventListener("click", () => {
            const selectedLanguage = languageSelectElement?.value;
            console.log("ğŸš€ ë²ˆì—­ ë²„íŠ¼ í´ë¦­, ì„ íƒëœ ì–¸ì–´:", selectedLanguage);

            if (!selectedLanguage) {
              console.error("âŒ ì–¸ì–´ê°€ ì„ íƒë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤");
              return;
            }

            // ë²ˆì—­ ìš”ì²­ ì „ì†¡
            parent.postMessage(
              {
                pluginMessage: {
                  type: "translate-texts",
                  targetLanguage: selectedLanguage,
                },
              },
              "*"
            );
          });
        }

        if (refreshBtnElement) {
          refreshBtnElement.addEventListener("click", () => {
            console.log("ğŸ”„ ìƒˆë¡œê³ ì¹¨ ë²„íŠ¼ í´ë¦­");

            // í…ìŠ¤íŠ¸ ë‹¤ì‹œ ìš”ì²­
            parent.postMessage(
              {
                pluginMessage: {
                  type: "get-texts",
                },
              },
              "*"
            );
          });
        }

        const regenerateUxBtnElement =
          document.getElementById("regenerateUxBtn");
        if (regenerateUxBtnElement) {
          regenerateUxBtnElement.addEventListener("click", () => {
            console.log("âœ¨ UX ë¼ì´íŒ… ì¬ìƒì„± ë²„íŠ¼ í´ë¦­");

            if (currentTexts.length === 0) {
              alert("ì¬ìƒì„±í•  í…ìŠ¤íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.");
              return;
            }

            // í™•ì¸ ë‹¤ì´ì–¼ë¡œê·¸
            const confirmed = confirm(
              `${currentTexts.length}ê°œì˜ í…ìŠ¤íŠ¸ì— ëŒ€í•´ ìƒˆë¡œìš´ UX ë¼ì´íŒ…ì„ ìƒì„±í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`
            );

            if (confirmed) {
              // UX ë¼ì´íŒ… ì¬ìƒì„± ì¤‘ í‘œì‹œ
              const textPairContainer =
                document.getElementById("textPairContainer");
              if (textPairContainer) {
                textPairContainer.innerHTML = `
                  <div class="empty-state">
                    <div class="icon">âœ¨</div>
                    <div>ìƒˆë¡œìš´ UX ë¼ì´íŒ…ì„ ìƒì„±í•˜ëŠ” ì¤‘...</div>
                  </div>
                `;
              }

              parent.postMessage(
                {
                  pluginMessage: {
                    type: "regenerate-ux-writing",
                  },
                },
                "*"
              );
            }
          });
        }

        // API í‚¤ëŠ” .env íŒŒì¼ì—ì„œ ìë™ ë¡œë“œë¨

        // í…ŒìŠ¤íŠ¸ ë°ì´í„° ì¦‰ì‹œ í‘œì‹œ
        if (textListElement) {
          textListElement.innerHTML = `
            <div style="padding: 10px; background: yellow; margin: 5px;">
              ğŸ§ª ì™¼ìª½ íŒ¨ë„ ì‘ë™ í™•ì¸! ê³§ ì‹¤ì œ ë°ì´í„°ë¡œ ì—…ë°ì´íŠ¸ë©ë‹ˆë‹¤.
            </div>
          `;
        }

        if (uxWritingListElement) {
          uxWritingListElement.innerHTML = `
            <div style="padding: 10px; background: lightblue; margin: 5px;">
              ğŸ§ª ì˜¤ë¥¸ìª½ íŒ¨ë„ ì‘ë™ í™•ì¸! UX ë¼ì´íŒ… ë°ì´í„°ë¥¼ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘...
            </div>
          `;
        }

        // ë©”ì‹œì§€ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
        window.onmessage = (event) => {
          console.log("ğŸŸ¡ UIì—ì„œ ë©”ì‹œì§€ ë°›ìŒ:", event);

          if (!event.data.pluginMessage) {
            console.log("âŒ pluginMessage ì—†ìŒ, ë¬´ì‹œ");
            return;
          }

          const { type, texts, uxTexts, languages, language } =
            event.data.pluginMessage;
          console.log("âœ… UI ë©”ì‹œì§€ ì²˜ë¦¬:", type);
          console.log("ğŸ“Š ë°ì´í„°:", {
            textsCount: texts?.length,
            uxTextsCount: uxTexts?.length,
          });

          switch (type) {
            case "initial-texts":
            case "texts-collected":
              console.log("ğŸ”„ í…ìŠ¤íŠ¸ì™€ ì–¸ì–´ ì—…ë°ì´íŠ¸");

              if (texts && Array.isArray(texts)) {
                console.log("ğŸ“ í…ìŠ¤íŠ¸ ë°ì´í„°:", texts);
                updateOriginalTextList(texts);
              } else {
                console.error("âŒ textsê°€ ë°°ì—´ì´ ì•„ë‹˜:", texts);
              }

              if (languages) {
                console.log("ğŸŒ ì–¸ì–´ ë°ì´í„°:", languages);
                updateLanguageOptions(languages);
              }
              break;

            case "ux-texts-ready":
              console.log("ğŸ”„ UX ë¼ì´íŒ… ì¤€ë¹„ ì™„ë£Œ");

              if (uxTexts && Array.isArray(uxTexts)) {
                console.log("ğŸ“ UX í…ìŠ¤íŠ¸ ë°ì´í„°:", uxTexts);
                updateUxWritingList(uxTexts);
              } else {
                console.error("âŒ uxTextsê°€ ë°°ì—´ì´ ì•„ë‹˜:", uxTexts);
              }
              break;

            case "translation-complete":
              console.log("ğŸ‰ ë²ˆì—­ ì™„ë£Œ!");
              break;

            case "text-selected":
              console.log("ğŸ¯ í…ìŠ¤íŠ¸ ì„ íƒë¨:", event.data.pluginMessage);
              const { nodeId, content, isNearest } = event.data.pluginMessage;
              highlightAndScrollToText(nodeId, isNearest);
              break;

            case "node-selected":
              console.log(
                "ğŸ¯ Figmaì—ì„œ ë…¸ë“œ ì„ íƒë¨:",
                event.data.pluginMessage
              );
              const { textInfo } = event.data.pluginMessage;
              if (textInfo && textInfo.id) {
                // Figmaì—ì„œ ì„ íƒí•œ í…ìŠ¤íŠ¸ë¥¼ UIì—ì„œ í•˜ì´ë¼ì´íŠ¸í•˜ê³  ìŠ¤í¬ë¡¤
                highlightAndScrollToText(textInfo.id, false);
              }
              break;

            case "ux-generation-progress":
              console.log(
                "ğŸ¨ UX ë¼ì´íŒ… ìƒì„± ì§„í–‰ë¥ :",
                event.data.pluginMessage
              );
              updateProgressBar(event.data.pluginMessage, "UX ë¼ì´íŒ…");
              break;

            case "translation-progress":
              console.log("ğŸŒ ë²ˆì—­ ì§„í–‰ë¥ :", event.data.pluginMessage);
              updateProgressBar(event.data.pluginMessage, "ë²ˆì—­");
              break;

            case "apply-csv-data":
              console.log("ğŸ“Š CSV ë°ì´í„° ì ìš© ì™„ë£Œ");
              alert("CSV ë°ì´í„°ê°€ ì„±ê³µì ìœ¼ë¡œ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤!");
              break;

            // API í‚¤ ìƒíƒœëŠ” .env íŒŒì¼ì—ì„œ ìë™ ê´€ë¦¬ë¨

            default:
              console.log("ğŸ”„ ì•Œ ìˆ˜ ì—†ëŠ” ë©”ì‹œì§€ íƒ€ì…:", type);
              break;
          }
        };

        // í•¨ìˆ˜ë“¤ ì •ì˜

        // API í‚¤ëŠ” .env íŒŒì¼ì—ì„œ ìë™ ê´€ë¦¬ë˜ë¯€ë¡œ ìƒíƒœ ì—…ë°ì´íŠ¸ í•¨ìˆ˜ ë¶ˆí•„ìš”

        function updateOriginalTextList(texts) {
          console.log("ğŸ“ ì›ë³¸ í…ìŠ¤íŠ¸ ëª©ë¡ ì—…ë°ì´íŠ¸, ê°œìˆ˜:", texts.length);
          currentTexts = texts;

          // UX í…ìŠ¤íŠ¸ê°€ ìˆìœ¼ë©´ í•¨ê»˜ ì—…ë°ì´íŠ¸
          if (currentUxTexts.length > 0) {
            updateTextPairs(texts, currentUxTexts);
          }
        }

        function updateUxWritingList(uxTexts) {
          console.log("ğŸ“ UX ë¼ì´íŒ… ëª©ë¡ ì—…ë°ì´íŠ¸, ê°œìˆ˜:", uxTexts.length);
          currentUxTexts = uxTexts;

          // ì›ë³¸ í…ìŠ¤íŠ¸ê°€ ìˆìœ¼ë©´ í•¨ê»˜ ì—…ë°ì´íŠ¸
          if (currentTexts.length > 0) {
            updateTextPairs(currentTexts, uxTexts);
          }
        }

        // ìƒˆë¡œìš´ í…ìŠ¤íŠ¸ ìŒ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateTextPairs(texts, uxTexts) {
          console.log("ğŸ“ í…ìŠ¤íŠ¸ ìŒ ì—…ë°ì´íŠ¸, ê°œìˆ˜:", texts.length);

          const textPairContainer =
            document.getElementById("textPairContainer");
          if (!textPairContainer) {
            console.error("âŒ textPairContainerê°€ ì—†ìŠµë‹ˆë‹¤!");
            return;
          }

          if (texts.length === 0) {
            textPairContainer.innerHTML = `
              <div class="empty-state">
                <div class="icon">ğŸ¤”</div>
                <div>í…ìŠ¤íŠ¸ê°€ ë°œê²¬ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤</div>
              </div>
            `;
            return;
          }

          const textPairs = texts
            .map((text, index) => {
              const uxText = uxTexts.find((ux) => ux.id === text.id);

              const truncatedOriginal = text.content;

              const truncatedUx = uxText ? uxText.uxContent : "ìƒì„± ì¤‘...";

              return `
                <div class="text-pair">
                  <div class="text-item" data-id="${
                    text.id
                  }" data-index="${index}" 
                       title="${text.content.replace(/"/g, "&quot;")}">
                    ${truncatedOriginal || "[ë¹ˆ í…ìŠ¤íŠ¸]"}
                  </div>
                  <div class="ux-item" data-id="${
                    text.id
                  }" data-index="${index}" 
                       title="${
                         uxText
                           ? uxText.uxContent.replace(/"/g, "&quot;")
                           : "ìƒì„± ì¤‘..."
                       }">
                    ${truncatedUx}
                  </div>
                </div>
              `;
            })
            .join("");

          textPairContainer.innerHTML = textPairs;

          console.log("âœ… í…ìŠ¤íŠ¸ ìŒ ì—…ë°ì´íŠ¸ ì™„ë£Œ");
        }

        function updateLanguageOptions(languages) {
          supportedLanguages = languages;

          if (!languageSelectElement) return;

          // ê¸°ì¡´ ì˜µì…˜ ì œê±° (ì²« ë²ˆì§¸ ê¸°ë³¸ ì˜µì…˜ ì œì™¸)
          while (languageSelectElement.children.length > 1) {
            languageSelectElement.removeChild(languageSelectElement.lastChild);
          }

          // ìƒˆ ì–¸ì–´ ì˜µì…˜ ì¶”ê°€
          Object.entries(languages).forEach(([code, name]) => {
            const option = document.createElement("option");
            option.value = code;
            option.textContent = name;
            languageSelectElement.appendChild(option);
          });
        }

        // í™œì„± ìƒíƒœ ì—…ë°ì´íŠ¸ í•¨ìˆ˜ ì¶”ê°€
        function updateActiveStates(textId, isUxMode) {
          // ëª¨ë“  ì•„ì´í…œì—ì„œ active í´ë˜ìŠ¤ ì œê±°
          document.querySelectorAll(".text-item, .ux-item").forEach((item) => {
            item.classList.remove("active");
          });

          // í•´ë‹¹ ì•„ì´í…œì— active í´ë˜ìŠ¤ ì¶”ê°€
          const selector = isUxMode
            ? `.ux-item[data-id="${textId}"]`
            : `.text-item[data-id="${textId}"]`;

          const activeItem = document.querySelector(selector);
          if (activeItem) {
            activeItem.classList.add("active");
          }
        }

        // ì§„í–‰ë¥  ë°” ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateProgressBar(progressData, processType) {
          const { current, total, message } = progressData;

          // ìƒíƒœ ë©”ì‹œì§€ ì—…ë°ì´íŠ¸
          const statusElement = document.getElementById("status");
          if (statusElement) {
            const percentage =
              total > 0 ? Math.round((current / total) * 100) : 0;
            statusElement.innerHTML = `
              <div style="margin-bottom: 8px;">${processType} ì§„í–‰ë¥ : ${current}/${total} (${percentage}%)</div>
              <div style="background: #f0f0f0; border-radius: 4px; overflow: hidden; height: 8px;">
                <div style="background: #4f46e5; height: 100%; transition: width 0.3s ease; width: ${percentage}%"></div>
              </div>
              <div style="margin-top: 8px; font-size: 12px; color: #666;">${message}</div>
            `;
            statusElement.style.display = "block";
          }

          // ì™„ë£Œ ì‹œ ìƒíƒœ ë°” ìˆ¨ê¸°ê¸°
          if (current >= total) {
            setTimeout(() => {
              if (statusElement) {
                statusElement.style.display = "none";
              }
            }, 3000);
          }
        }

        // í…ìŠ¤íŠ¸ í•˜ì´ë¼ì´íŠ¸ ë° ìŠ¤í¬ë¡¤ í•¨ìˆ˜
        function highlightAndScrollToText(nodeId, isNearest = false) {
          console.log(
            `ğŸ¯ í…ìŠ¤íŠ¸ í•˜ì´ë¼ì´íŠ¸ ìš”ì²­: ${nodeId}, ê°€ì¥ ê°€ê¹Œìš´ í…ìŠ¤íŠ¸: ${isNearest}`
          );

          // ëª¨ë“  í•˜ì´ë¼ì´íŠ¸ ì œê±°
          document.querySelectorAll(".text-item, .ux-item").forEach((item) => {
            item.classList.remove("highlighted", "nearest-highlighted");
          });

          // í•´ë‹¹ í…ìŠ¤íŠ¸ ìŒ ì°¾ê¸°
          const textItem = document.querySelector(
            `.text-item[data-id="${nodeId}"]`
          );
          const uxItem = document.querySelector(
            `.ux-item[data-id="${nodeId}"]`
          );

          if (textItem && uxItem) {
            // í•˜ì´ë¼ì´íŠ¸ í´ë˜ìŠ¤ ì¶”ê°€
            const highlightClass = isNearest
              ? "nearest-highlighted"
              : "highlighted";
            textItem.classList.add(highlightClass);
            uxItem.classList.add(highlightClass);

            // í…ìŠ¤íŠ¸ ìŒ ì»¨í…Œì´ë„ˆë¡œ ìŠ¤í¬ë¡¤
            const textPair = textItem.closest(".text-pair");
            if (textPair) {
              textPair.scrollIntoView({
                behavior: "smooth",
                block: "center",
              });

              console.log(`âœ… í…ìŠ¤íŠ¸ë¡œ ìŠ¤í¬ë¡¤ ì™„ë£Œ: ${nodeId}`);

              // ì ì‹œ í›„ í•˜ì´ë¼ì´íŠ¸ íš¨ê³¼ ì œê±° (ê°€ì¥ ê°€ê¹Œìš´ í…ìŠ¤íŠ¸ê°€ ì•„ë‹Œ ê²½ìš°)
              if (!isNearest) {
                setTimeout(() => {
                  textItem.classList.remove("highlighted");
                  uxItem.classList.remove("highlighted");
                }, 3000);
              }
            }
          } else {
            console.warn(`âš ï¸ í…ìŠ¤íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ${nodeId}`);
          }
        }

        // í´ë¦­ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡ (í•œ ë²ˆë§Œ)
        const textPairContainer = document.getElementById("textPairContainer");
        if (textPairContainer) {
          // ë‹¨ì¼ í´ë¦­ ì´ë²¤íŠ¸
          textPairContainer.addEventListener("click", (e) => {
            const textItem = e.target.closest(".text-item");
            const uxItem = e.target.closest(".ux-item");

            if (textItem) {
              const textId = textItem.dataset.id;
              console.log("ğŸ”„ ì›ë³¸ í…ìŠ¤íŠ¸ í´ë¦­:", textId);

              parent.postMessage(
                {
                  pluginMessage: {
                    type: "apply-original-text",
                    nodeId: textId,
                  },
                },
                "*"
              );

              updateActiveStates(textId, false);
            } else if (uxItem) {
              const textId = uxItem.dataset.id;
              const textIndex = uxItem.dataset.index;
              console.log("ğŸ”„ UX Writing í´ë¦­:", textId);

              // ì €ì¥ëœ UX í…ìŠ¤íŠ¸ ì°¾ê¸°
              const uxText = currentUxTexts.find((ux) => ux.id === textId);
              if (uxText) {
                console.log("ğŸ“ ì €ì¥ëœ UX í…ìŠ¤íŠ¸ ì°¾ìŒ:", uxText.uxContent);
                parent.postMessage(
                  {
                    pluginMessage: {
                      type: "apply-ux-text",
                      nodeId: textId,
                      uxContent: uxText.uxContent,
                    },
                  },
                  "*"
                );
              } else {
                console.error("âŒ ì €ì¥ëœ UX í…ìŠ¤íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ:", textId);
              }

              updateActiveStates(textId, true);
            }
          });

          // ë”ë¸”í´ë¦­ ì´ë²¤íŠ¸ (Figma ìº”ë²„ìŠ¤ì—ì„œ í…ìŠ¤íŠ¸ í¬ì»¤ìŠ¤)
          textPairContainer.addEventListener("dblclick", (e) => {
            const textItem = e.target.closest(".text-item");
            const uxItem = e.target.closest(".ux-item");

            if (textItem || uxItem) {
              const textId = (textItem || uxItem).dataset.id;
              console.log("ğŸ¯ ë”ë¸”í´ë¦­ìœ¼ë¡œ í…ìŠ¤íŠ¸ í¬ì»¤ìŠ¤ ìš”ì²­:", textId);

              parent.postMessage(
                {
                  pluginMessage: {
                    type: "focus-text-node",
                    nodeId: textId,
                  },
                },
                "*"
              );
            }
          });
        }

        // ì´ˆê¸°í™”: í”ŒëŸ¬ê·¸ì¸ì— í…ìŠ¤íŠ¸ ìš”ì²­
        setTimeout(() => {
          console.log("ğŸ“¤ ì´ˆê¸° í…ìŠ¤íŠ¸ ìš”ì²­ ì „ì†¡");
          parent.postMessage(
            {
              pluginMessage: {
                type: "get-texts",
              },
            },
            "*"
          );
        }, 100);

        console.log("ğŸ¯ UI ì´ˆê¸°í™” ì™„ë£Œ");
      }
    </script>
    <script>
      console.log("ğŸ§ª HTMLì—ì„œ ui.js ë¡œë“œ ì‹œë„ í›„");
    </script>
  </body>
</html>
