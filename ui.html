<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>í…ìŠ¤íŠ¸ ë²ˆì—­ê¸°1</title>
    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        font-family: Inter, -apple-system, BlinkMacSystemFont, "Segoe UI",
          Roboto, sans-serif;
        font-size: 12px;
        line-height: 1.5;
        background: #f8f9fa;
        padding: 16px;
      }

      .container {
        max-width: 100%;
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        overflow: hidden;
      }

      .header {
        background: #4f46e5;
        color: white;
        padding: 16px;
        text-align: center;
      }

      .header h1 {
        font-size: 16px;
        font-weight: 600;
        margin-bottom: 4px;
      }

      .header p {
        font-size: 11px;
        opacity: 0.8;
      }

      .content {
        padding: 16px;
      }

      .main-content {
        display: flex;
        gap: 16px;
        height: 400px;
      }

      .left-panel,
      .right-panel {
        flex: 1;
        display: flex;
        flex-direction: column;
      }

      .panel-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 8px;
        padding-bottom: 8px;
        border-bottom: 2px solid #e5e7eb;
      }

      .panel-title {
        font-size: 13px;
        font-weight: 600;
        color: #374151;
      }

      .panel-subtitle {
        font-size: 10px;
        color: #6b7280;
      }

      .section {
        margin-bottom: 24px;
      }

      .section h2 {
        font-size: 13px;
        font-weight: 600;
        color: #374151;
        margin-bottom: 8px;
      }

      .text-list {
        background: #f9fafb;
        border: 1px solid #e5e7eb;
        border-radius: 6px;
        flex: 1;
        overflow-y: auto;
        padding: 8px;
      }

      .text-item {
        padding: 8px 12px;
        margin-bottom: 6px;
        background: white;
        border-radius: 4px;
        font-size: 11px;
        color: #374151;
        border-left: 3px solid #e5e7eb;
        word-break: break-all;
        cursor: pointer;
        transition: all 0.2s;
        position: relative;
      }

      .text-item:hover {
        border-left-color: #4f46e5;
        background: #f8fafc;
      }

      .text-item:last-child {
        margin-bottom: 0;
      }

      .text-item.active {
        border-left-color: #4f46e5;
        background: #eef2ff;
      }

      .text-item.changed {
        border-left-color: #10b981;
        background: #f0fdf4;
      }

      .text-item-badge {
        position: absolute;
        top: 4px;
        right: 4px;
        background: #4f46e5;
        color: white;
        font-size: 8px;
        padding: 2px 4px;
        border-radius: 2px;
        opacity: 0;
        transition: opacity 0.2s;
      }

      .text-item.changed .text-item-badge {
        opacity: 1;
        background: #10b981;
      }

      .ux-writing-list {
        background: #fefefe;
        border: 1px solid #e5e7eb;
        border-radius: 6px;
        flex: 1;
        overflow-y: auto;
        padding: 8px;
      }

      .ux-item {
        padding: 8px 12px;
        margin-bottom: 6px;
        background: #f8f9fa;
        border-radius: 4px;
        font-size: 11px;
        color: #374151;
        border-left: 3px solid #fbbf24;
        word-break: break-all;
        cursor: pointer;
        transition: all 0.2s;
        position: relative;
      }

      .ux-item:hover {
        border-left-color: #f59e0b;
        background: #fffbeb;
      }

      .ux-item:last-child {
        margin-bottom: 0;
      }

      .ux-item.active {
        border-left-color: #f59e0b;
        background: #fffbeb;
      }

      .language-selector {
        margin-bottom: 16px;
      }

      .language-selector label {
        display: block;
        font-size: 11px;
        color: #374151;
        margin-bottom: 4px;
        font-weight: 500;
      }

      .language-selector select {
        width: 100%;
        padding: 8px 12px;
        border: 1px solid #d1d5db;
        border-radius: 6px;
        font-size: 12px;
        background: white;
        color: #374151;
      }

      .language-selector select:focus {
        outline: none;
        border-color: #4f46e5;
        box-shadow: 0 0 0 2px rgba(79, 70, 229, 0.1);
      }

      .button-group {
        display: flex;
        gap: 8px;
      }

      .btn {
        flex: 1;
        padding: 10px 16px;
        border: none;
        border-radius: 6px;
        font-size: 12px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s;
      }

      .btn-primary {
        background: #4f46e5;
        color: white;
      }

      .btn-primary:hover:not(:disabled) {
        background: #4338ca;
      }

      .btn-secondary {
        background: #f3f4f6;
        color: #374151;
        border: 1px solid #d1d5db;
      }

      .btn-secondary:hover:not(:disabled) {
        background: #e5e7eb;
      }

      .btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      .loading {
        display: none;
        text-align: center;
        padding: 16px;
        color: #6b7280;
        font-size: 11px;
      }

      .loading.show {
        display: block;
      }

      .spinner {
        display: inline-block;
        width: 16px;
        height: 16px;
        border: 2px solid #f3f4f6;
        border-radius: 50%;
        border-top-color: #4f46e5;
        animation: spin 1s ease-in-out infinite;
        margin-right: 8px;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      .status {
        margin-top: 16px;
        padding: 8px 12px;
        border-radius: 6px;
        font-size: 11px;
        display: none;
      }

      .status.success {
        background: #f0f9f0;
        color: #065f46;
        border: 1px solid #a7f3d0;
        display: block;
      }

      .empty-state {
        text-align: center;
        padding: 32px 16px;
        color: #9ca3af;
        font-size: 11px;
      }

      .empty-state .icon {
        font-size: 24px;
        margin-bottom: 8px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>í…ìŠ¤íŠ¸ ë²ˆì—­ê¸°1234</h1>
        <p>Figma í˜ì´ì§€ì˜ í…ìŠ¤íŠ¸ë¥¼ ë‹¤ë¥¸ ì–¸ì–´ë¡œ ë²ˆì—­í•©ë‹ˆë‹¤</p>
      </div>

      <div class="content">
        <div class="main-content">
          <div class="left-panel">
            <div class="section">
              <h2>ë°œê²¬ëœ í…ìŠ¤íŠ¸</h2>
              <div id="textList" class="text-list">
                <div class="empty-state">
                  <div class="icon">ğŸ“</div>
                  <div>í…ìŠ¤íŠ¸ë¥¼ ê²€ìƒ‰í•˜ëŠ” ì¤‘...</div>
                </div>
              </div>
            </div>

            <div class="section">
              <div class="language-selector">
                <label for="languageSelect">ë²ˆì—­í•  ì–¸ì–´ ì„ íƒ</label>
                <select id="languageSelect">
                  <option value="">ì–¸ì–´ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                </select>
              </div>

              <div class="button-group">
                <button id="refreshBtn" class="btn btn-secondary">
                  ğŸ”„ í…ìŠ¤íŠ¸ ìƒˆë¡œê³ ì¹¨
                </button>
                <button id="translateBtn" class="btn btn-primary" disabled>
                  ğŸŒ ë²ˆì—­í•˜ê¸°
                </button>
              </div>

              <div id="loading" class="loading">
                <div class="spinner"></div>
                ë²ˆì—­ ì¤‘ì…ë‹ˆë‹¤...
              </div>

              <div id="status" class="status"></div>
            </div>
          </div>

          <div class="right-panel">
            <div class="section">
              <h2>UX Writing</h2>
              <div id="uxWritingList" class="ux-writing-list">
                <div class="empty-state">
                  <div class="icon">ğŸ“</div>
                  <div>UX Writingì„ ê²€ìƒ‰í•˜ëŠ” ì¤‘...</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- UI ë¡œì§ì€ ui.jsì—ì„œ ì²˜ë¦¬ë©ë‹ˆë‹¤ -->
    <script>
      console.log("ğŸ§ª HTMLì—ì„œ ui.js ë¡œë“œ ì‹œë„ ì „");
    </script>
    <script>
      // ui.js ë‚´ìš©ì„ ì¸ë¼ì¸ìœ¼ë¡œ í¬í•¨
      "use strict";
      console.log("ğŸš€ UI ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œë¨ (ì¸ë¼ì¸)");
      console.log("ğŸ“… í˜„ì¬ ì‹œê°„:", new Date().toISOString());
      console.log("ğŸŒ User Agent:", navigator.userAgent);

      // DOMì´ ì™„ì „íˆ ë¡œë“œë˜ì—ˆëŠ”ì§€ í™•ì¸
      document.addEventListener("DOMContentLoaded", function () {
        console.log("ğŸ“‹ DOMContentLoaded ì´ë²¤íŠ¸ ë°œìƒ");
      });

      // ì¦‰ì‹œ ì‹¤í–‰í•˜ì—¬ ì—°ê²° í™•ì¸
      setTimeout(() => {
        console.log("âš¡ ui.js ìŠ¤í¬ë¦½íŠ¸ê°€ ì •ìƒì ìœ¼ë¡œ ì‹¤í–‰ë˜ê³  ìˆìŠµë‹ˆë‹¤!");

        // DOM ìš”ì†Œë“¤ì´ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸
        const testElements = [
          "textList",
          "uxWritingList",
          "languageSelect",
          "refreshBtn",
          "translateBtn",
        ];

        testElements.forEach((id) => {
          const element = document.getElementById(id);
          console.log(`ğŸ” ${id}:`, element ? "âœ… ì¡´ì¬" : "âŒ ì—†ìŒ");
        });

        // ì‹¤ì œ ì´ˆê¸°í™” ì‹œì‘
        initializeUI();
      }, 100);

      // UI ì´ˆê¸°í™” í•¨ìˆ˜
      function initializeUI() {
        console.log("ğŸ¯ UI ì´ˆê¸°í™” ì‹œì‘");

        // UI ìš”ì†Œë“¤ ì°¾ê¸°
        const textListElement = document.getElementById("textList");
        const uxWritingListElement = document.getElementById("uxWritingList");
        const languageSelectElement = document.getElementById("languageSelect");
        const refreshBtnElement = document.getElementById("refreshBtn");
        const translateBtnElement = document.getElementById("translateBtn");
        const loadingElement = document.getElementById("loading");
        const statusElement = document.getElementById("status");

        console.log("ğŸ” DOM ìš”ì†Œ ì°¾ê¸° ê²°ê³¼:");
        console.log("  textListElement:", !!textListElement);
        console.log("  uxWritingListElement:", !!uxWritingListElement);
        console.log("  languageSelectElement:", !!languageSelectElement);

        // ìƒíƒœ ê´€ë¦¬
        let currentTexts = [];
        let currentUxTexts = [];
        let supportedLanguages = {};

        // í…ŒìŠ¤íŠ¸ ë°ì´í„° ì¦‰ì‹œ í‘œì‹œ
        if (textListElement) {
          textListElement.innerHTML = `
            <div style="padding: 10px; background: yellow; margin: 5px;">
              ğŸ§ª ì™¼ìª½ íŒ¨ë„ ì‘ë™ í™•ì¸! ê³§ ì‹¤ì œ ë°ì´í„°ë¡œ ì—…ë°ì´íŠ¸ë©ë‹ˆë‹¤.
            </div>
          `;
        }

        if (uxWritingListElement) {
          uxWritingListElement.innerHTML = `
            <div style="padding: 10px; background: lightblue; margin: 5px;">
              ğŸ§ª ì˜¤ë¥¸ìª½ íŒ¨ë„ ì‘ë™ í™•ì¸! UX ë¼ì´íŒ… ë°ì´í„°ë¥¼ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘...
            </div>
          `;
        }

        // ë©”ì‹œì§€ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
        window.onmessage = (event) => {
          console.log("ğŸŸ¡ UIì—ì„œ ë©”ì‹œì§€ ë°›ìŒ:", event);

          if (!event.data.pluginMessage) {
            console.log("âŒ pluginMessage ì—†ìŒ, ë¬´ì‹œ");
            return;
          }

          const { type, texts, uxTexts, languages, language } =
            event.data.pluginMessage;
          console.log("âœ… UI ë©”ì‹œì§€ ì²˜ë¦¬:", type);
          console.log("ğŸ“Š ë°ì´í„°:", {
            textsCount: texts?.length,
            uxTextsCount: uxTexts?.length,
          });

          switch (type) {
            case "initial-texts":
            case "texts-collected":
              console.log("ğŸ”„ í…ìŠ¤íŠ¸ì™€ ì–¸ì–´ ì—…ë°ì´íŠ¸");

              if (texts && Array.isArray(texts)) {
                console.log("ğŸ“ í…ìŠ¤íŠ¸ ë°ì´í„°:", texts);
                updateOriginalTextList(texts);
              } else {
                console.error("âŒ textsê°€ ë°°ì—´ì´ ì•„ë‹˜:", texts);
              }

              if (languages) {
                console.log("ğŸŒ ì–¸ì–´ ë°ì´í„°:", languages);
                updateLanguageOptions(languages);
              }
              break;

            case "ux-texts-ready":
              console.log("ğŸ”„ UX ë¼ì´íŒ… ì¤€ë¹„ ì™„ë£Œ");

              if (uxTexts && Array.isArray(uxTexts)) {
                console.log("ğŸ“ UX í…ìŠ¤íŠ¸ ë°ì´í„°:", uxTexts);
                updateUxWritingList(uxTexts);
              } else {
                console.error("âŒ uxTextsê°€ ë°°ì—´ì´ ì•„ë‹˜:", uxTexts);
              }
              break;

            case "translation-complete":
              console.log("ğŸ‰ ë²ˆì—­ ì™„ë£Œ!");
              break;

            default:
              console.log("ğŸ”„ ì•Œ ìˆ˜ ì—†ëŠ” ë©”ì‹œì§€ íƒ€ì…:", type);
              break;
          }
        };

        // í•¨ìˆ˜ë“¤ ì •ì˜
        function updateOriginalTextList(texts) {
          console.log("ğŸ“ ì›ë³¸ í…ìŠ¤íŠ¸ ëª©ë¡ ì—…ë°ì´íŠ¸, ê°œìˆ˜:", texts.length);
          currentTexts = texts;

          if (!textListElement) {
            console.error("âŒ textListElementê°€ ì—†ìŠµë‹ˆë‹¤!");
            return;
          }

          if (texts.length === 0) {
            textListElement.innerHTML = `
              <div class="empty-state">
                <div class="icon">ğŸ¤”</div>
                <div>í…ìŠ¤íŠ¸ê°€ ë°œê²¬ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤</div>
              </div>
            `;
            return;
          }

          const textItems = texts
            .map((text, index) => {
              const truncatedContent =
                text.content.length > 50
                  ? text.content.substring(0, 50) + "..."
                  : text.content;

              return `
              <div class="text-item" data-id="${
                text.id
              }" data-index="${index}" title="${text.content.replace(
                /"/g,
                "&quot;"
              )}">
                ${truncatedContent || "[ë¹ˆ í…ìŠ¤íŠ¸]"}
              </div>
            `;
            })
            .join("");

          textListElement.innerHTML = textItems;
          console.log("âœ… ì›ë³¸ í…ìŠ¤íŠ¸ ëª©ë¡ ì—…ë°ì´íŠ¸ ì™„ë£Œ");
        }

        function updateUxWritingList(uxTexts) {
          console.log("ğŸ“ UX ë¼ì´íŒ… ëª©ë¡ ì—…ë°ì´íŠ¸, ê°œìˆ˜:", uxTexts.length);
          currentUxTexts = uxTexts;

          if (!uxWritingListElement) {
            console.error("âŒ uxWritingListElementê°€ ì—†ìŠµë‹ˆë‹¤!");
            return;
          }

          if (uxTexts.length === 0) {
            uxWritingListElement.innerHTML = `
              <div class="empty-state">
                <div class="icon">ğŸ“</div>
                <div>UX Writingì„ ìƒì„±í•˜ëŠ” ì¤‘...</div>
              </div>
            `;
            return;
          }

          const uxItems = uxTexts
            .map((text, index) => {
              const truncatedContent =
                text.uxContent.length > 50
                  ? text.uxContent.substring(0, 50) + "..."
                  : text.uxContent;

              return `
              <div class="ux-item" data-id="${
                text.id
              }" data-index="${index}" title="${text.uxContent.replace(
                /"/g,
                "&quot;"
              )}">
                ${truncatedContent || "[ë¹ˆ í…ìŠ¤íŠ¸]"}
              </div>
            `;
            })
            .join("");

          uxWritingListElement.innerHTML = uxItems;
          console.log("âœ… UX ë¼ì´íŒ… ëª©ë¡ ì—…ë°ì´íŠ¸ ì™„ë£Œ");
        }

        function updateLanguageOptions(languages) {
          supportedLanguages = languages;

          if (!languageSelectElement) return;

          // ê¸°ì¡´ ì˜µì…˜ ì œê±° (ì²« ë²ˆì§¸ ê¸°ë³¸ ì˜µì…˜ ì œì™¸)
          while (languageSelectElement.children.length > 1) {
            languageSelectElement.removeChild(languageSelectElement.lastChild);
          }

          // ìƒˆ ì–¸ì–´ ì˜µì…˜ ì¶”ê°€
          Object.entries(languages).forEach(([code, name]) => {
            const option = document.createElement("option");
            option.value = code;
            option.textContent = name;
            languageSelectElement.appendChild(option);
          });
        }

        // ì´ˆê¸°í™”: í”ŒëŸ¬ê·¸ì¸ì— í…ìŠ¤íŠ¸ ìš”ì²­
        setTimeout(() => {
          console.log("ğŸ“¤ ì´ˆê¸° í…ìŠ¤íŠ¸ ìš”ì²­ ì „ì†¡");
          parent.postMessage(
            {
              pluginMessage: {
                type: "get-texts",
              },
            },
            "*"
          );
        }, 100);

        console.log("ğŸ¯ UI ì´ˆê¸°í™” ì™„ë£Œ");
      }
    </script>
    <script>
      console.log("ğŸ§ª HTMLì—ì„œ ui.js ë¡œë“œ ì‹œë„ í›„");
    </script>
  </body>
</html>
